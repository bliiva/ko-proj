<?xml version="1.0" encoding="UTF-8"?>
<solver xmlns="https://timefold.ai/xsd/solver"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="https://timefold.ai/xsd/solver https://timefold.ai/xsd/solver/solver.xsd">

    <environmentMode>PHASE_ASSERT</environmentMode>

    <!-- Model -->
    <solutionClass>lv.lu.eztf.dn.combopt.evrp.domain.EVRPsolution</solutionClass>
    <entityClass>lv.lu.eztf.dn.combopt.evrp.domain.Gate</entityClass>
    <entityClass>lv.lu.eztf.dn.combopt.evrp.domain.Visit</entityClass>

    <!-- Score -->
    <scoreDirectorFactory>
        <constraintProviderClass>lv.lu.eztf.dn.combopt.evrp.solver.ConstraintStreamCostFunction</constraintProviderClass>
    </scoreDirectorFactory>

    <!-- Total solver stop condition -->
    <!-- If you prefer fixed time, replace diminishedReturns with secondsSpentLimit -->
    <termination>
        <secondsSpentLimit>120</secondsSpentLimit>
        <!-- or: <diminishedReturns/> -->
    </termination>

    <!-- Phase 1: Build a decent initial schedule -->
    <constructionHeuristic/>

    <!-- Phase 2: Main improvement (best for gate scheduling) -->
    <localSearch>
        <!-- Optional: stop this phase early if it stalls -->
        <termination>
            <secondsSpentLimit>90</secondsSpentLimit>
            <!-- or: <diminishedReturns/> -->
        </termination>

        <unionMoveSelector>
            <subListChangeMoveSelector/>
            <listChangeMoveSelector/>
            <listSwapMoveSelector/>
            <kOptListMoveSelector/>
        </unionMoveSelector>

        <acceptor>
            <!-- Tabu: good default for scheduling -->
            <valueTabuSize>10</valueTabuSize>
        </acceptor>

        <forager>
            <!-- Explore more accepted moves before picking best -->
            <acceptedCountLimit>1000</acceptedCountLimit>
        </forager>
    </localSearch>

    <!-- Phase 3: Polish (only equal-or-improving moves) -->
    <localSearch>
        <termination>
            <secondsSpentLimit>30</secondsSpentLimit>
        </termination>

        <unionMoveSelector>
            <subListChangeMoveSelector/>
            <listChangeMoveSelector/>
            <listSwapMoveSelector/>
            <kOptListMoveSelector/>
        </unionMoveSelector>

        <acceptor>
            <stepCountingHillClimbingSize>1</stepCountingHillClimbingSize>
            <stepCountingHillClimbingType>EQUAL_OR_IMPROVING_STEP</stepCountingHillClimbingType>
        </acceptor>

        <forager>
            <acceptedCountLimit>1</acceptedCountLimit>
        </forager>
    </localSearch>
</solver>
